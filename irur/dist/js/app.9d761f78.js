(function(t){function e(e){for(var n,r,s=e[0],c=e[1],d=e[2],l=0,f=[];l<s.length;l++)r=s[l],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&f.push(o[r][0]),o[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);u&&u(e);while(f.length)f.shift()();return i.push.apply(i,d||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],n=!0,s=1;s<a.length;s++){var c=a[s];0!==o[c]&&(n=!1)}n&&(i.splice(e--,1),t=r(r.s=a[0]))}return t}var n={},o={app:0},i=[];function r(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=n,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var d=0;d<s.length;d++)e(s[d]);var u=c;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),o=a("b079"),i=a.n(o),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.mode,attrs:{id:"app",tabindex:"0"},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"]))return null;t.mode="normal",t.loader=!1}}},[a("vue-context",{ref:"tabMenu",scopedSlots:t._u([{key:"default",fn:function(e){return[a("li",[a("a",{attrs:{href:"#","data-id":"add"},on:{click:function(a){return a.preventDefault(),t.tabContextMenu(a,e.data)}}},[t._v("Add")])]),a("li",[a("a",{attrs:{href:"#","data-id":"rename"},on:{click:function(a){return a.preventDefault(),t.tabContextMenu(a,e.data)}}},[t._v("Rename")])]),a("li",[a("a",{class:e.data,attrs:{href:"#","data-id":"delete"},on:{click:function(a){return a.preventDefault(),t.tabContextMenu(a,e.data)}}},[t._v("Delete")])])]}}])}),a("vue-context",{ref:"knobMenu",scopedSlots:t._u([{key:"default",fn:function(e){return[a("li",[a("a",{attrs:{href:"#","data-id":"add"},on:{click:function(a){return a.preventDefault(),t.knobContextMenu(a,e.data)}}},[t._v("Add")])]),a("li",[a("a",{attrs:{href:"#","data-id":"edit"},on:{click:function(a){return a.preventDefault(),t.knobContextMenu(a,e.data)}}},[t._v("Edit")])]),a("li",[a("a",{attrs:{href:"#","data-id":"sort"},on:{click:function(a){return a.preventDefault(),t.knobContextMenu(a,e.data)}}},[t._v("Sort")])]),a("li",[a("a",{attrs:{href:"#","data-id":"remove"},on:{click:function(a){return a.preventDefault(),t.knobContextMenu(a,e.data)}}},[t._v("Remove")])])]}}])}),a("div",{attrs:{id:"svg-sprite"}}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.loader,expression:"loader"}],attrs:{id:"loader"}},[a("div",{staticClass:"icon"})]),a("div",{attrs:{id:"add-overlay"},on:{click:t.closeModal,keydown:function(e){return(e.type.indexOf("key")||83===e.keyCode)&&e.ctrlKey&&e.shiftKey?t.submitForm(e):null}}},[a("form",{attrs:{action:"#",id:"form1",autocomplete:"off"}},[a("div",{attrs:{id:"close"},on:{click:t.closeModal}}),t._m(0),a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.name,expression:"saveData.name"}],ref:"name",attrs:{type:"text",id:"knob_name",required:""},domProps:{value:t.saveData.name},on:{input:function(e){e.target.composing||t.$set(t.saveData,"name",e.target.value)}}}),t._m(1),a("div",{attrs:{id:"mqtt"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.mqtt,expression:"saveData.mqtt"}],attrs:{type:"text",id:"knob_mqtt",required:""},domProps:{value:t.saveData.mqtt},on:{input:function(e){e.target.composing||t.$set(t.saveData,"mqtt",e.target.value)}}}),a("button",{attrs:{disabled:t.listeningMqtt},on:{click:function(e){return e.preventDefault(),t.receiveIR(e)}}},[t._v("Listen")])]),t._m(2),a("div",{attrs:{id:"knob_mqtt_topic"}},t._l(t.settings.topic_send,(function(e,n){return a("p",{key:n},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.topic_send,expression:"saveData.topic_send"}],attrs:{type:"radio",required:"",id:"mqttTopic-"+n},domProps:{checked:1===t.settings.topic_send.length,value:e,checked:t._q(t.saveData.topic_send,e)},on:{change:function(a){return t.$set(t.saveData,"topic_send",e)}}}),a("label",{attrs:{for:"mqttTopic-"+n}},[t._v(t._s(e))])])})),0),a("label",{attrs:{for:"knob_id"}},[t._v("Unique id "),a("span",{staticClass:"mono"},[t._v(" curl "+t._s(t.settings.hostname)+t._s(t.api.send)+"/"+t._s(t.saveData.id)+" ")])]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.id,expression:"saveData.id"}],attrs:{type:"text",id:"knob_id",required:"",readonly:""},domProps:{value:t.saveData.id},on:{input:function(e){e.target.composing||t.$set(t.saveData,"id",e.target.value)}}}),t._m(3),a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.icon,expression:"saveData.icon"}],attrs:{type:"text",id:"knob_icon"},domProps:{value:t.saveData.icon},on:{input:function(e){e.target.composing||t.$set(t.saveData,"icon",e.target.value)}}}),a("div",{attrs:{id:"glyphs"}},t._l(t.filteredGlyphs,(function(e){return a("div",{key:e,staticClass:"glyph",attrs:{"data-name":e,title:e},domProps:{innerHTML:t._s(t.glyph(e))},on:{click:function(a){t.saveData.icon=e}}})})),0),t._m(4),a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.color,expression:"saveData.color"}],attrs:{type:"text",id:"knob_color"},domProps:{value:t.saveData.color},on:{input:function(e){e.target.composing||t.$set(t.saveData,"color",e.target.value)}}}),a("slider-picker",{model:{value:t.colors,callback:function(e){t.colors=e},expression:"colors"}}),a("button",{attrs:{form:"form1"},on:{click:function(e){return e.preventDefault(),t.submitForm(e)}}},[t._v("Save")]),t._m(5)],1)]),a("div",{attrs:{id:"tabs"}},t._l(t.data,(function(e,n){return a("div",{key:n,staticClass:"tab",class:{active:t.activeTab===n},attrs:{"data-id":n},on:{contextmenu:function(e){return e.preventDefault(),t.$refs.tabMenu.open(e,n)},click:function(e){t.activeTab=n}}},["tab-rename"===t.mode&&t.activeTab===n?a("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.name,expression:"item.name",modifiers:{trim:!0}}],attrs:{type:"text",id:"menu-item-"+n},domProps:{value:e.name},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveTab()},blur:[function(a){""===e.name?e.name="New":e.name=e.name,t.saveTab()},function(e){return t.$forceUpdate()}],input:function(a){a.target.composing||t.$set(e,"name",a.target.value.trim())}}}):a("span",[t._v(" "+t._s(e.name)+" ")])])})),0),a("draggable",{attrs:{id:"remote",disabled:"sort"!=this.mode,draggable:".item"},on:{change:t.save},model:{value:t.filteredData,callback:function(e){t.filteredData=e},expression:"filteredData"}},[a("div",{staticClass:"item-add",attrs:{slot:"footer",draggable:"false"},on:{click:function(e){t.mode="add"}},slot:"footer"},[a("div",{staticClass:"glyph"},[a("svg",{staticClass:"icon"},[a("use",{attrs:{"xlink:href":"#add"}})])])]),t._l(t.filteredData,(function(e){return a("div",{key:e.id,staticClass:"item",attrs:{title:e.name},on:{contextmenu:function(a){return a.preventDefault(),t.$refs.knobMenu.open(a,e.id)},click:function(a){return t.sendIR(e.id)}}},[e.icon?a("div",{staticClass:"glyph"},[a("svg",{staticClass:"icon",style:"fill:"+e.color},[a("use",{attrs:{"xlink:href":"#"+e.icon}})])]):a("div",{class:["no-icon len-"+e.name.length],style:"color:"+e.color},[t._v(" "+t._s(e.name)+" ")])])}))],2)],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"knob_name"}},[t._v("Name "),a("span",[t._v("Name for your knob")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"knob_mqtt"}},[t._v("MQTT response "),a("span",[t._v("If no icon is selected, the name will be used")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"knob_mqtt_topic"}},[t._v("MQTT topic "),a("span",[t._v("Add new topics from HA configuration")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"knob_icon"}},[t._v("Icon "),a("span",[t._v("If no icon is selected, the name is being used")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"knob_color"}},[t._v("Color "),a("span",[t._v(" Color for the icon. Leave blank for default that depends on the parent theme. ")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"keybinds"},[a("strong",[t._v("Control+Shift+S")]),t._v(" to save, "),a("strong",[t._v("Esc")]),t._v(" to close ")])}],c=(a("99af"),a("4de4"),a("caad"),a("c975"),a("fb6a"),a("45fc"),a("b0c0"),a("d3b7"),a("25f0"),a("ade3")),d=a("5530"),u=a("3835"),l=a("310e"),f=a.n(l),m=a("c345"),v=a("899b"),h=(a("a89b"),{name:"App",components:{draggable:f.a,VueContext:v["a"],"slider-picker":m["Slider"]},data:function(){return{mode:"normal",loader:!0,glyphs:[],manager:{active:!1,text:"Manager"},activeTab:"default",data:{default:{name:"Default",knobs:[]}},colors:{hex:this.cssVar("--text")},saveData:{id:"",name:"",mqtt:"",topic_send:"",icon:"",color:this.cssVar("--text")},listeningMqtt:!1,api:{prefix:"".concat(this.getHostname(),"api/"),receive:"ir/receive",send:"ir/send",save:"db/save",load:"db/load",settings:"settings"},settings:{topic_send:""}}},computed:{filteredGlyphs:function(){var t=this;return this.glyphs.filter((function(e){return e.toLowerCase().indexOf(t.saveData.icon.toLowerCase())>-1}))},filteredData:{get:function(){return this.data[this.activeTab].knobs},set:function(t){this.data[this.activeTab].knobs=t}}},watch:{mode:function(t){var e=this;"editor"===t?setTimeout((function(){return e.$refs.name.focus()}),500):"add"===t&&(this.saveData={name:"",mqtt:"",id:this.generateUID(),icon:"",color:this.cssVar("--text"),topic_send:this.saveData.topic_send},setTimeout((function(){return e.$refs.name.focus()}),500))},colors:function(t){this.saveData.color=t.hex}},filters:{defaultValue:function(t){return""===t?"New":t}},mounted:function(){this.load(),this.loadSVG()},methods:{load:function(){var t=this;fetch("".concat(this.api.prefix).concat(this.api.load)).then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status));return t.json()})).then((function(e){"error"===e.status?t.loadDefaultDB():t.data=e})).catch((function(e){t.$toast.error(String(e))})),fetch("".concat(this.api.prefix).concat(this.api.settings)).then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status));return t.json()})).then((function(e){t.settings=e;var a=Object(u["a"])(e.topic_send,1);if(t.saveData.topic_send=a[0],e.dark_theme){var n=document.getElementsByTagName("html")[0];n.setAttribute("data-theme","dark")}})).catch((function(e){t.$toast.error(String(e))}))},loadDefaultDB:function(){this.data={default:{name:"Default",knobs:[{id:"wn0gbd99",name:"Samsung Volume Up",mqtt:'{"Protocol":"SAMSUNG","Bits":32,"Data":"0xE0E0E01F"}',icon:"up-arrow",topic_send:""},{id:"wt9u3yzj",name:"Samsung Volume Down",mqtt:'{"Protocol":"SAMSUNG","Bits":32,"Data":"0xE0E0D02F"}',icon:"down-arrow",topic_send:""}]}}},toggleManager:function(){this.manager.active?(this.mode="normal",this.manager.text="Manager"):(this.manager.text="Normal",this.mode="normal"),this.manager.active=!this.manager.active},knobContextMenu:function(t,e){var a=t.target.dataset.id;"add"===a&&(this.mode="add"),"edit"===a&&(this.saveData=this.filteredData[this.findObjIndex(e)],this.mode="editor"),"sort"===a&&("sort"===this.mode?this.mode="normal":this.mode="sort"),"remove"===a&&(this.filteredData=this.filteredData.filter((function(t){return t.id!==e})),this.save())},changeMqttTopic:function(t){this.saveData.topic_send=t},tabContextMenu:function(t,e){var a=t.target.dataset.id;if("rename"===a&&(this.activeTab=e,this.mode="tab-rename",setTimeout((function(){return document.querySelector("#menu-item-".concat(e)).focus()}),200)),"add"===a){var n=this.generateUID();this.data=Object(d["a"])(Object(d["a"])({},this.data),Object(c["a"])({},n,{name:"New",knobs:[]})),this.activeTab=n,this.mode="tab-rename",setTimeout((function(){return document.querySelector("#menu-item-".concat(n)).focus()}),200),this.save()}"delete"===a&&"default"!==e&&(e===this.activeTab&&(this.activeTab="default"),this.$delete(this.data,e),this.save())},saveTab:function(){this.mode="normal",this.save()},loadSVG:function(){var t=this,e=this;fetch("icons/sprite.svg").then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status));return t.text()})).then((function(a){var n=document.getElementById("svg-sprite");n.innerHTML=a,document.body.insertBefore(n,document.body.childNodes[0]);var o=(new DOMParser).parseFromString(a,"text/xml"),i=o.getElementsByTagName("symbol");if(!i.length)throw new Error("Cannot generate svg icons");t.loader=!1;for(var r=0;r<i.length;r+=1)e.glyphs.push(i[r].getAttribute("id"))})).catch((function(e){t.$toast.error(String(e))}))},save:function(){var t=this;"editor"===this.mode?this.filteredData[this.findObjIndex()]={id:this.saveData.id,name:this.saveData.name,mqtt:this.saveData.mqtt,topic_send:this.saveData.topic_send,icon:this.saveData.icon,color:this.saveData.color}:"add"===this.mode&&this.filteredData.push(this.saveData),fetch("".concat(this.api.prefix).concat(this.api.save),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(this.data)}).then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status))})).catch((function(e){t.$toast.error(String(e))}))},sendIR:function(t){var e=this;fetch("".concat(this.api.prefix).concat(this.api.send,"/").concat(t)).then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status))})).then((function(){e.loader=!1})).catch((function(t){e.$toast.error(String(t)),e.loader=!1}))},receiveIR:function(){var t=this,e=this;this.loader=!0;var a=5,n=new AbortController,o=setTimeout((function(){n.abort()}),1e3*a);function i(){e.listeningMqtt=!1,e.loader=!1,clearTimeout(o)}fetch("".concat(this.api.prefix).concat(this.api.receive),{signal:n.signal}).then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status));return t.json()})).then((function(a){i(),e.saveData.mqtt=a.mqtt,t.$toast.info("Ir code received")})).catch((function(e){i(),"AbortError"===e.name?t.$toast.info("Stopped listening after ".concat(a," seconds of no incoming messages")):t.$toast.error(String(e))}))},submitForm:function(){var t=this.saveData,e=[t.name,t.mqtt,t.id,t.topic_send];e.some((function(t){return""===t||void 0===t}))?this.$toast.error("Name, id, mqtt and topic required"):(this.save(),"editor"===this.mode?this.mode="edit":this.mode="normal")},glyph:function(t){return'<svg class="icon" style="fill: '.concat(this.saveData.color,'">\n                <use xlink:href="#').concat(t,'"></use>\n              </svg>')},closeModal:function(t){["add-overlay","close"].includes(t.target.id)&&(this.mode="normal",this.loader=!1)},findObjIndex:function(t){for(var e,a=t||this.saveData.id,n=0;n<this.filteredData.length;n+=1)this.filteredData[n].id===a&&(e=n);return e},generateUID:function(){return Math.random().toString(36).slice(-8)},cssVar:function(t){return getComputedStyle(document.documentElement).getPropertyValue(t)},getHostname:function(){return""}}}),p=h,g=a("2877"),b=Object(g["a"])(p,r,s,!1,null,null,null),_=b.exports;n["default"].config.productionTip=!1,n["default"].use(i.a,{duration:4e3,type:"default",position:"bottom"}),new n["default"]({render:function(t){return t(_)}}).$mount("#app")},a89b:function(t,e,a){}});
//# sourceMappingURL=app.9d761f78.js.map