(function(t){function e(e){for(var o,s,r=e[0],d=e[1],c=e[2],l=0,m=[];l<r.length;l++)s=r[l],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&m.push(a[s][0]),a[s]=0;for(o in d)Object.prototype.hasOwnProperty.call(d,o)&&(t[o]=d[o]);u&&u(e);while(m.length)m.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],o=!0,r=1;r<n.length;r++){var d=n[r];0!==a[d]&&(o=!1)}o&&(i.splice(e--,1),t=s(s.s=n[0]))}return t}var o={},a={app:0},i=[];function s(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=o,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],d=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=d;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"115d":function(t,e,n){},"11f0":function(t,e,n){},"367e":function(t,e,n){"use strict";var o=n("11f0"),a=n.n(o);a.a},"56d7":function(t,e,n){"use strict";n.r(e);n("a79d");var o=n("2b0e"),a=n("b079"),i=n.n(a),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"app",class:t.layout.mode,attrs:{id:"app",tabindex:"0"}},[n("svg-sprite",{on:{loaded:function(e){t.layout.icons=e,t.layout.showLoader=!1}}}),n("undo",{directives:[{name:"show",rawName:"v-show",value:t.layout.showUndo,expression:"layout.showUndo"}],ref:"undo",attrs:{db:t.db},on:{undo:function(e){t.db=e,t.sync()},show:function(e){t.layout.showUndo=!0},timer:function(e){t.layout.showUndo=!1}},nativeOn:{click:function(e){t.layout.showUndo=!1}}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.layout.showLoader,expression:"layout.showLoader"}],attrs:{id:"loader"}},[n("div",{staticClass:"icon"})]),n("editor",{attrs:{db:t.db,layout:t.layout,options:t.options},on:{"switch-mode":function(e){return t.switchMode(e)},edit:function(e){return t.editKnob(e)},loading:function(e){t.layout.showLoader=e}}}),n("tabs",{attrs:{db:t.db,layout:t.layout},on:{"switch-tab":function(e){t.layout.activeTab=e},"switch-mode":function(e){return t.switchMode(e)},save:function(e){return t.saveTab(e)},remove:function(e){return t.removeTab(e)}}}),n("remote",{attrs:{db:t.db,layout:t.layout,options:t.options},on:{sort:function(e){return t.sync("sort")},remove:function(e){return t.removeKnob()},"switch-mode":function(e){return t.switchMode(e)}}})],1)},r=[],d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"svg-sprite"}})},c=[],u={data(){return{glyphs:[]}},mounted(){this.load()},methods:{load(){fetch("icons/sprite.svg").then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status);return t.text()}).then(t=>{this.parse(t)}).catch(t=>{this.$toast.error(String(t))})},parse(t){const e=document.getElementById("svg-sprite"),n=(new DOMParser).parseFromString(t,"text/xml"),o=n.getElementsByTagName("symbol");if(!o.length)throw new Error("Cannot generate svg icons");e.innerHTML=t;for(let a=0;a<o.length;a+=1)this.glyphs.push(o[a].getAttribute("id"));this.$emit("loaded",this.glyphs)}}},l=u,m=(n("fc63"),n("2877")),h=Object(m["a"])(l,d,c,!1,null,null,null),f=h.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a",{ref:"undoButton",attrs:{href:"#"},on:{keydown:function(e){return(e.type.indexOf("key")||90===e.keyCode)&&e.ctrlKey?t.undo(e):null},click:function(e){return e.preventDefault(),t.undo(e)}}},[n("span",[t._v("Undo")]),n("svg",[n("use",{attrs:{"xlink:href":"#fast-forward"}})])])},v=[],b={props:{db:{type:Object,required:!0}},data(){return{db_history:{}}},mounted(){this.$refs.undoButton.focus()},methods:{undo(){this.$emit("undo",this.db_history)},record(){this.db_history=JSON.parse(JSON.stringify(this.db)),this.timer(),this.$emit("show")},timer(){setTimeout(()=>{this.$emit("timer")},5e3)}}},y=b,k=(n("367e"),Object(m["a"])(y,p,v,!1,null,"380a7a18",null)),g=k.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"add-overlay"},on:{click:function(e){return t.closeModal(e)}}},[n("form",{attrs:{action:"#",id:"form1",autocomplete:"off"},on:{submit:function(e){return t.validate()},keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.closeModal(e,!0)}}},[n("div",{attrs:{id:"close"},on:{click:function(e){return t.closeModal(e)}}}),t._m(0),n("input",{directives:[{name:"model",rawName:"v-model",value:t.knobSaveData.name,expression:"knobSaveData.name"}],ref:"editorNameField",attrs:{type:"text",id:"knob_name",required:""},domProps:{value:t.knobSaveData.name},on:{input:function(e){e.target.composing||t.$set(t.knobSaveData,"name",e.target.value)}}}),t._m(1),n("div",{attrs:{id:"mqtt"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.knobSaveData.mqtt,expression:"knobSaveData.mqtt"}],attrs:{type:"text",id:"knob_mqtt",required:""},domProps:{value:t.knobSaveData.mqtt},on:{input:function(e){e.target.composing||t.$set(t.knobSaveData,"mqtt",e.target.value)}}}),n("button",{attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.recordIR()}}},[t._v("Listen")])]),t._m(2),n("div",{attrs:{id:"knob_mqtt_topic"}},t._l(t.options.settings.topic_send,(function(e,o){return n("p",{key:o},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.knobSaveData.topic_send,expression:"knobSaveData.topic_send"}],ref:"mqtt-checkbox-"+o,refInFor:!0,attrs:{type:"radio",required:"",id:"mqtt-label-"+o},domProps:{value:e,checked:t._q(t.knobSaveData.topic_send,e)},on:{change:function(n){return t.$set(t.knobSaveData,"topic_send",e)}}}),n("label",{attrs:{for:"mqtt-label-"+o}},[t._v(t._s(e))])])})),0),n("label",{attrs:{for:"knob_id"}},[t._v("Unique id "),n("span",{staticClass:"mono"},[t._v(" $ curl "+t._s(t.options.settings.hostname)+t._s(t.options.api.send)+t._s(t.knobSaveData.id)+"/ ")])]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.knobSaveData.id,expression:"knobSaveData.id"}],attrs:{type:"text",id:"knob_id",required:"",readonly:""},domProps:{value:t.knobSaveData.id},on:{input:function(e){e.target.composing||t.$set(t.knobSaveData,"id",e.target.value)}}}),t._m(3),n("input",{directives:[{name:"model",rawName:"v-model",value:t.knobSaveData.icon,expression:"knobSaveData.icon"}],ref:"icon",attrs:{type:"text",id:"knob_icon"},domProps:{value:t.knobSaveData.icon},on:{input:function(e){e.target.composing||t.$set(t.knobSaveData,"icon",e.target.value)}}}),n("div",{attrs:{id:"glyphs"}},t._l(t.filteredIcons,(function(e){return n("div",{key:e,staticClass:"glyph",attrs:{title:e},domProps:{innerHTML:t._s(t.renderIcon(e))},on:{click:function(n){t.knobSaveData.icon=e,t.$refs.icon.focus()}}})})),0),t._m(4),n("input",{directives:[{name:"model",rawName:"v-model",value:t.knobSaveData.color,expression:"knobSaveData.color"}],attrs:{type:"text",id:"knob_color"},domProps:{value:t.knobSaveData.color},on:{input:function(e){e.target.composing||t.$set(t.knobSaveData,"color",e.target.value)}}}),n("slider-picker",{model:{value:t.colors,callback:function(e){t.colors=e},expression:"colors"}}),n("button",{attrs:{form:"form1"},on:{click:function(e){return e.preventDefault(),t.validate()}}},[t._v("Save")]),t._m(5)],1)])},w=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("label",{attrs:{for:"knob_name"}},[t._v("Name "),n("span",[t._v("Name for the knob")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("label",{attrs:{for:"knob_mqtt"}},[t._v("MQTT response "),n("span",[t._v("Tap listen and press a remote button towards IR receiver")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("label",{attrs:{for:"knob_mqtt_topic"}},[t._v("MQTT topic "),n("span",[t._v("Add new topics from HA configuration")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("label",{attrs:{for:"knob_icon"}},[t._v("Icon "),n("span",[t._v("If no icon is selected, the name is being used")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("label",{attrs:{for:"knob_color"}},[t._v("Color "),n("span",[t._v("Color for the icon. Leave blank for default that depends on the parent theme.")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",{staticClass:"keybinds"},[n("strong",[t._v("Enter")]),t._v(" to save, "),n("strong",[t._v("Esc")]),t._v(" to close ")])}],S=(n("ddb0"),n("c345")),D={methods:{genUID(){return Math.random().toString(36).slice(-8)},getHostname(){let t="";return t},cssVar(t){return getComputedStyle(document.documentElement).getPropertyValue(t)},scaffoldDB(){return{default:{name:"Default",knobs:[{id:"wn0gbd99",name:"Samsung Volume Up",mqtt:'{"Protocol":"SAMSUNG","Bits":32,"Data":"0xE0E0E01F"}',icon:"up-arrow",topic_send:"irur/cmnd/IRsend"},{id:"wt9u3yzj",name:"Samsung Volume Down",mqtt:'{"Protocol":"SAMSUNG","Bits":32,"Data":"0xE0E0D02F"}',icon:"down-arrow",topic_send:"irur/cmnd/IRsend"}]}}}}},$={mixins:[D],components:{"slider-picker":S["Slider"]},props:{db:{type:Object,required:!0},layout:{type:Object,required:!0},options:{type:Object,required:!0}},watch:{layout:{deep:!0,handler(t,e){if("add"===e.mode&&(this.colors={hex:this.cssVar("--text")},this.knobSaveData={name:"",mqtt:"",id:this.genUID(),icon:"",color:this.cssVar("--text"),topic_send:this.options.settings.topic_send},1===this.options.settings.topic_send.length&&([this.knobSaveData.topic_send]=this.options.settings.topic_send),setTimeout(()=>this.$refs.editorNameField.focus(),50)),"edit"===e.mode){const t=JSON.parse(JSON.stringify(this.db[this.layout.activeTab].knobs[this.layout.activeEdit.index]));this.knobSaveData=t,void 0===this.knobSaveData.color&&(this.knobSaveData.color=this.cssVar("--text")),this.colors={hex:this.knobSaveData.color},setTimeout(()=>this.$refs.editorNameField.focus(),50)}}},colors(t){this.knobSaveData.color=t.hex}},data(){return{knobSaveData:{id:"",name:"",mqtt:"",topic_send:"",icon:"",color:this.cssVar("--text")},colors:{hex:this.cssVar("--text")},icons:[]}},computed:{filteredIcons(){return this.layout.icons.filter(t=>t.toLowerCase().indexOf(this.knobSaveData.icon.toLowerCase())>-1)}},methods:{save(){this.$emit("edit",this.knobSaveData),this.$emit("switch-mode",{mode:"normal"})},recordIR(){const t=this;this.$emit("loading",!0);const e=5,n=new AbortController,o=setTimeout(()=>{n.abort()},1e3*e);function a(){t.$emit("loading",!1),clearTimeout(o)}fetch(`${this.options.api.prefix}${this.options.api.receive}`,{signal:n.signal}).then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status);return t.json()}).then(e=>{a(),t.knobSaveData.mqtt=e.mqtt,this.$toast.info("Ir code received")}).catch(t=>{a(),"AbortError"===t.name?this.$toast.info(`Stopped listening after ${e} seconds of no incoming messages`):this.$toast.error(String(t))})},validate(){const t=this.knobSaveData,e=[t.name,t.mqtt,t.id,t.topic_send];e.some(t=>""===t||void 0===t)?this.$toast.error("Name, id, mqtt and topic required"):(this.save(),this.mode="normal")},renderIcon(t){return`<svg class="icon" style="fill: ${this.knobSaveData.color}">\n                <use xlink:href="#${t}"></use>\n              </svg>`},closeModal(t,e){(["add-overlay","close"].includes(t.target.id)||e)&&this.$emit("switch-mode",{mode:"normal"})}}},x=$,T=(n("58d3"),Object(m["a"])(x,_,w,!1,null,null,null)),E=T.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"tabs"}},[n("vue-context",{ref:"menu",scopedSlots:t._u([{key:"default",fn:function(e){return[n("li",[n("a",{attrs:{"data-name":"add"},on:{click:function(n){return n.preventDefault(),t.menu(n,e.data)}}},[t._v("Add")])]),n("li",[n("a",{attrs:{"data-name":"rename"},on:{click:function(n){return n.preventDefault(),t.menu(n,e.data)}}},[t._v("Rename")])]),n("li",["default"!==e.data?n("a",{attrs:{"data-name":"remove"},on:{click:function(n){return n.preventDefault(),t.menu(n,e.data)}}},[t._v("Remove")]):t._e()])]}}])}),t._l(t.db,(function(e,o){return n("div",{key:o,staticClass:"tab",class:{active:t.layout.activeTab===o},attrs:{"data-id":o},on:{contextmenu:function(e){return e.preventDefault(),t.$refs.menu.open(e,o)},click:function(e){return t.switchTab(o)}}},["tab-rename"===t.layout.mode&&t.layout.activeTab===o?n("input",{directives:[{name:"model",rawName:"v-model",value:t.tabSaveData.name,expression:"tabSaveData.name"}],ref:"tab-"+o,refInFor:!0,attrs:{type:"text"},domProps:{value:t.tabSaveData.name},on:{blur:function(e){return t.saveTab()},focus:function(n){t.tabSaveData.name=e.name},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.target.blur()},input:function(e){e.target.composing||t.$set(t.tabSaveData,"name",e.target.value)}}}):n("span",[t._v(" "+t._s(e.name)+" ")])])}))],2)},q=[],P=n("899b"),j={mixins:[D],components:{VueContext:P["a"]},props:{db:{type:Object,required:!0},layout:{type:Object,required:!0}},data(){return{tabSaveData:{id:"",name:""}}},methods:{switchTab(t){this.$emit("switch-tab",t)},saveTab(){this.$emit("save",{data:this.tabSaveData}),this.$emit("switch-mode",{mode:"normal"})},menu(t,e){switch(t.target.dataset.name){case"add":{const t=this.genUID();this.tabSaveData={name:"New",id:t},this.$emit("save",{data:this.tabSaveData,mode:"tab-rename"}),this.$emit("switch-tab",t),setTimeout(()=>{this.$refs["tab-"+t][0].focus()},50);break}case"rename":this.tabSaveData.id=e,this.$emit("switch-tab",e),this.$emit("switch-mode",{mode:"tab-rename"}),setTimeout(()=>this.$refs["tab-"+e][0].focus(),50);break;case"remove":e===this.layout.activeTab&&this.$emit("switch-tab","default"),this.$emit("remove",e)}}}},I=j,C=(n("6f10"),Object(m["a"])(I,O,q,!1,null,null,null)),N=C.exports,M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("vue-context",{ref:"menu",scopedSlots:t._u([{key:"default",fn:function(e){return[n("li",[n("a",{attrs:{href:"#","data-id":"add"},on:{click:function(n){return n.preventDefault(),t.menu(n,e.data)}}},[t._v("Add")])]),n("li",[n("a",{attrs:{href:"#","data-id":"edit"},on:{click:function(n){return n.preventDefault(),t.menu(n,e.data)}}},[t._v("Edit")])]),n("li",[n("a",{attrs:{href:"#","data-id":"sort"},on:{click:function(n){return n.preventDefault(),t.menu(n,e.data)}}},[t._v("Sort")])]),n("li",[n("a",{attrs:{href:"#","data-id":"remove"},on:{click:function(n){return n.preventDefault(),t.menu(n,e.data)}}},[t._v("Remove")])])]}}])}),n("draggable",{attrs:{id:"remote",draggable:".item",disabled:"sort"!=this.layout.mode},on:{change:function(e){return t.$emit("sort")}},model:{value:t.filteredDB,callback:function(e){t.filteredDB=e},expression:"filteredDB"}},[n("div",{staticClass:"add",attrs:{slot:"footer",draggable:"false"},on:{click:function(e){return t.$emit("switch-mode",{mode:"add"})}},slot:"footer"},[n("div",{staticClass:"glyph"},[n("svg",{staticClass:"icon"},[n("use",{attrs:{"xlink:href":"#add"}})])])]),t._l(t.filteredDB,(function(e,o){return n("div",{key:e.id,staticClass:"item",attrs:{title:e.name},on:{click:function(n){return t.sendIr(e.id)},contextmenu:function(n){return n.preventDefault(),t.$refs.menu.open(n,{id:e.id,index:o})}}},[e.icon?n("div",{staticClass:"glyph"},[n("svg",{staticClass:"icon",style:"fill: "+e.color+";"},[n("use",{attrs:{"xlink:href":"#"+e.icon}})])]):n("div",{class:"no-icon len-"+e.name.length,style:"style: "+e.color+";"},[t._v(" "+t._s(e.name)+" ")])])}))],2)],1)},A=[],U=n("310e"),B=n.n(U),L={components:{draggable:B.a,VueContext:P["a"]},props:{db:{type:Object,required:!0},layout:{type:Object,required:!0},options:{type:Object,required:!0}},watch:{db(){this.data=this.db}},data(){return{data:{default:{name:"Default",knobs:[]}}}},computed:{filteredDB:{get(){return this.data[this.layout.activeTab].knobs},set(t){this.data[this.layout.activeTab].knobs=t}}},methods:{menu(t,e){const n=t.target.dataset.id;this.$emit("switch-mode",{mode:n,id:e.id,index:e.index}),"remove"===n&&this.$emit("remove")},sendIr(t){const e=this.options.api.prefix;fetch(`${e}${this.options.api.send}${t}/`).then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status)}).then(()=>{this.loader=!1}).catch(t=>{this.$toast.error(String(t)),this.loader=!1})}}},H=L,V=(n("6b37"),Object(m["a"])(H,M,A,!1,null,null,null)),R=V.exports,F=(n("a89b"),{name:"App",mixins:[D],components:{SvgSprite:f,Undo:g,Editor:E,Tabs:N,Remote:R},data(){return{layout:{mode:"normal",showLoader:!0,showUndo:!1,activeTab:"default",activeEdit:{},icons:[]},options:{api:{prefix:this.getHostname()+"api/",receive:"ir/receive/",send:"ir/send/",save:"db/save/",load:"db/load/",settings:"settings/"},settings:{topic_send:""}},db:{default:{name:"Default",knobs:[]}}}},mounted(){this.loadDatabase(),this.loadSettings()},methods:{loadDatabase(){const t=this.options.api.prefix;fetch(`${t}${this.options.api.load}`).then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status);return t.json()}).then(t=>{"error"===t.status?(this.db=this.scaffoldDB(),this.sync()):this.db=t}).catch(t=>{this.$toast.error(String(t))})},loadSettings(){const t=this.options.api.prefix;fetch(`${t}${this.options.api.settings}`).then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status);return t.json()}).then(t=>{if(this.options.settings=t,"true"===String(t.dark_theme).toLowerCase()){const t=document.getElementsByTagName("html")[0];t.setAttribute("data-theme","dark")}}).catch(t=>{this.$toast.error(String(t))})},switchMode(t){const{mode:e,id:n,index:o}=t;this.layout.mode=e,this.layout.activeEdit={id:n,index:o},"normal"===this.layout.mode&&(this.loader=!1)},sync(t="normal"){const e=this.options.api.prefix;fetch(`${e}${this.options.api.save}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(this.db)}).then(e=>{if(this.layout.mode=t,!e.ok)throw new Error("API HTTP status "+e.status)}).catch(t=>{this.$toast.error(String(t))})},editKnob(t){"edit"===this.layout.mode?this.db[this.layout.activeTab].knobs[this.layout.activeEdit.index]=t:"add"===this.layout.mode&&this.db[this.layout.activeTab].knobs.push(t),this.sync()},removeKnob(){this.$refs.undo.record();const{index:t}=this.layout.activeEdit;this.$delete(this.db[this.layout.activeTab].knobs,t),this.sync()},saveTab(t){const{id:e,name:n}=t.data;!{}.hasOwnProperty.call(this.db,e)?this.db={...this.db,[e]:{name:n,knobs:[]}}:this.db[e].name=n,this.sync(t.mode)},removeTab(t){this.$refs.undo.record(),this.$delete(this.db,t),this.sync()}}}),J=F,K=Object(m["a"])(J,s,r,!1,null,null,null),G=K.exports;o["default"].config.productionTip=!1,o["default"].use(i.a,{duration:4e3,type:"default",position:"bottom"}),new o["default"]({render:t=>t(G)}).$mount("#app")},"58d3":function(t,e,n){"use strict";var o=n("f08e"),a=n.n(o);a.a},"5bf7":function(t,e,n){},"6b37":function(t,e,n){"use strict";var o=n("5bf7"),a=n.n(o);a.a},"6f10":function(t,e,n){"use strict";var o=n("75aa"),a=n.n(o);a.a},"75aa":function(t,e,n){},a89b:function(t,e,n){},f08e:function(t,e,n){},fc63:function(t,e,n){"use strict";var o=n("115d"),a=n.n(o);a.a}});
//# sourceMappingURL=app.ad7561f7.js.map