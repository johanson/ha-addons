(function(t){function e(e){for(var a,r,s=e[0],c=e[1],l=e[2],d=0,f=[];d<s.length;d++)r=s[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&f.push(o[r][0]),o[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(f.length)f.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(a=!1)}a&&(i.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},o={app:0},i=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),o=n("b079"),i=n.n(o),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.mode,attrs:{id:"app",tabindex:"0"},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"]))return null;t.mode="normal"}}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.loader,expression:"loader"}],attrs:{id:"loader"}}),n("div",{attrs:{id:"svg-sprite"}}),n("div",{attrs:{id:"add-overlay"},on:{click:t.closeModal,keydown:function(e){return(e.type.indexOf("key")||83===e.keyCode)&&e.ctrlKey&&e.shiftKey?t.submitForm(e):null}}},[n("form",{attrs:{action:"#",id:"form1",autocomplete:"off"}},[n("div",{attrs:{id:"close"},on:{click:t.closeModal}}),t._m(0),n("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.name,expression:"saveData.name"}],ref:"name",attrs:{type:"text",id:"knob_name",required:""},domProps:{value:t.saveData.name},on:{input:function(e){e.target.composing||t.$set(t.saveData,"name",e.target.value)}}}),t._m(1),n("div",{attrs:{id:"mqtt"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.mqtt,expression:"saveData.mqtt"}],attrs:{type:"text",id:"knob_mqtt",required:""},domProps:{value:t.saveData.mqtt},on:{input:function(e){e.target.composing||t.$set(t.saveData,"mqtt",e.target.value)}}}),n("button",{attrs:{disabled:t.listeningMqtt},on:{click:function(e){return e.preventDefault(),t.receiveIR(e)}}},[t._v("Listen")])]),n("label",{attrs:{for:"knob_id"}},[t._v("Unique id "),n("span",[n("a",{attrs:{href:t.api.prefix+t.api.send+"/"+t.saveData.id,target:"_blank"}},[t._v(" "+t._s(t.api.prefix)+t._s(t.api.send)+"/"+t._s(t.saveData.id)+" ")])])]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.id,expression:"saveData.id"}],attrs:{type:"text",id:"knob_id",required:"",readonly:""},domProps:{value:t.saveData.id},on:{input:function(e){e.target.composing||t.$set(t.saveData,"id",e.target.value)}}}),t._m(2),n("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.icon,expression:"saveData.icon"}],attrs:{type:"text",id:"knob_icon"},domProps:{value:t.saveData.icon},on:{input:function(e){e.target.composing||t.$set(t.saveData,"icon",e.target.value)}}}),n("div",{attrs:{id:"glyphs"}},t._l(t.filteredGlyphs,(function(e){return n("div",{key:e,staticClass:"glyph",attrs:{"data-name":e,title:e},domProps:{innerHTML:t._s(t.glyph(e))},on:{click:function(n){t.saveData.icon=e}}})})),0),t._m(3),n("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.color,expression:"saveData.color"}],attrs:{type:"text",id:"knob_color"},domProps:{value:t.saveData.color},on:{input:function(e){e.target.composing||t.$set(t.saveData,"color",e.target.value)}}}),n("slider-picker",{model:{value:t.colors,callback:function(e){t.colors=e},expression:"colors"}}),n("button",{attrs:{form:"form1"},on:{click:function(e){return e.preventDefault(),t.submitForm(e)}}},[t._v("Save")]),t._m(4)],1)]),n("draggable",{attrs:{id:"remote",disabled:"sort"!=this.mode},on:{change:t.save},model:{value:t.list,callback:function(e){t.list=e},expression:"list"}},t._l(t.list,(function(e){return n("div",{key:e.id,staticClass:"item",attrs:{title:e.name},on:{click:function(n){return t.knobAction(e.id)}}},[e.icon?n("div",{staticClass:"glyph"},[n("svg",{staticClass:"icon",style:"fill:"+e.color},[n("use",{attrs:{"xlink:href":"#"+e.icon}})])]):n("div",{class:["no-icon len-"+e.name.length],style:"color:"+e.color},[t._v(" "+t._s(e.name)+" ")])])})),0),n("div",{attrs:{id:"menu"}},[t._v(" ["),n("a",{staticClass:"manager",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleManager(e)}}},[t._v(t._s(t.manager.text))]),t._v("] "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.manager.active,expression:"manager.active"}],staticClass:"container"},[t._v(" ["),n("a",{staticClass:"add",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.mode="add"}}},[t._v("Add")]),t._v(" | "),n("a",{staticClass:"edit",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.mode="edit"}}},[t._v("Edit")]),t._v(" | "),n("a",{staticClass:"sort",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.mode="sort"}}},[t._v("Sort")]),t._v(" | "),n("a",{staticClass:"remove",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.mode="remove"}}},[t._v("Remove")]),t._v("] ")])])],1)},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("label",{attrs:{for:"knob_name"}},[t._v("Name "),n("span",[t._v("Name for your knob")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("label",{attrs:{for:"knob_mqtt"}},[t._v("Mqtt response "),n("span",[t._v("If no icon is selected, the name will be used")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("label",{attrs:{for:"knob_icon"}},[t._v("Icon "),n("span",[t._v("If no icon is selected, the name is being used")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("label",{attrs:{for:"knob_color"}},[t._v("Color "),n("span",[t._v(" Color for the icon. Leave blank for default that depends on the parent theme. ")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("Control+Shift+S")]),t._v(" to save, "),n("strong",[t._v("Esc")]),t._v(" to close")])}],c=(n("99af"),n("4de4"),n("caad"),n("c975"),n("fb6a"),n("45fc"),n("b0c0"),n("d3b7"),n("25f0"),n("498a"),n("310e")),l=n.n(c),u=n("c345"),d=(n("a89b"),n("ce8c"),{name:"App",components:{draggable:l.a,"slider-picker":u["Slider"]},data:function(){return{mode:"normal",loader:!1,manager:{active:!1,text:"Manager"},list:[],glyphs:[],colors:{hex:this.cssVar("--text")},saveData:{id:"",name:"",mqtt:"",icon:"",color:this.cssVar("--text")},listeningMqtt:!1,api:{prefix:"".concat(this.getHostname(),"api/"),receive:"ir/receive",send:"ir/send",save:"db/save",load:"db/load",settings:"settings"},settings:{}}},computed:{filteredGlyphs:function(){var t=this;return this.glyphs.filter((function(e){return e.toLowerCase().indexOf(t.saveData.icon.toLowerCase())>-1}))}},watch:{mode:function(t){var e=this;"editor"===t?setTimeout((function(){return e.$refs.name.focus()}),500):"add"===t&&(this.saveData={name:"",mqtt:"",id:this.generateUID(),icon:""},setTimeout((function(){return e.$refs.name.focus()}),500))},colors:function(t){this.saveData.color=t.hex}},mounted:function(){this.load(),this.loadSVG()},methods:{load:function(){var t=this;fetch("".concat(this.api.prefix).concat(this.api.load)).then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status));return t.json()})).then((function(e){console.log("ok".concat(e)),t.list=e})).catch((function(e){t.$toast.error(String(e))})),fetch("".concat(this.api.prefix).concat(this.api.settings)).then((function(t){return t.json()})).then((function(e){t.settings=e;var n=document.getElementsByTagName("html")[0];t.settings.dark_theme&&n.setAttribute("data-theme","dark")}))},toggleManager:function(){this.manager.active?(this.mode="normal",this.manager.text="Manager"):(this.manager.text="Normal",this.mode="normal"),this.manager.active=!this.manager.active},loadSVG:function(){var t=this,e=this;fetch("icons/sprite.svg").then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status));return t.text()})).then((function(t){var n=document.getElementById("svg-sprite");n.innerHTML=t,document.body.insertBefore(n,document.body.childNodes[0]);var a=(new DOMParser).parseFromString(t,"text/xml"),o=a.getElementsByTagName("symbol");if(!o.length)throw new Error("Cannot generate svg icons");for(var i=0;i<o.length;i+=1)e.glyphs.push(o[i].getAttribute("id"))})).catch((function(e){t.$toast.error(String(e))}))},save:function(){var t=this;"editor"===this.mode?this.list[this.findObjIndex()]={id:this.saveData.id,name:this.saveData.name,mqtt:this.saveData.mqtt,icon:this.saveData.icon,color:this.saveData.color}:"add"===this.mode&&this.list.push(this.saveData),fetch("".concat(this.api.prefix).concat(this.api.save),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(this.list)}).then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status))})).then((function(){t.$toast.success("Saved")})).catch((function(e){t.$toast.error(String(e))}))},knobAction:function(t){switch(this.mode){case"edit":this.saveData=this.list[this.findObjIndex(t)],this.mode="editor";break;case"remove":this.list=this.list.filter((function(e){return e.id!==t})),this.save(),this.mode="normal";break;default:this.sendIR(t)}},sendIR:function(t){var e=this;fetch("".concat(this.api.prefix).concat(this.api.send,"/").concat(t)).then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status))})).then((function(){e.loader=!1})).catch((function(t){e.$toast.error(String(t)),e.loader=!1}))},receiveIR:function(){var t=this,e=this;this.listeningMqtt=!0,this.loader=!0;var n=5,a=new AbortController,o=setTimeout((function(){a.abort()}),1e3*n);function i(){e.listeningMqtt=!1,e.loader=!1,clearTimeout(o)}fetch("".concat(this.api.prefix).concat(this.api.receive),{signal:a.signal}).then((function(t){if(!t.ok)throw new Error("API HTTP status ".concat(t.status));return t.json()})).then((function(n){i(),e.saveData.mqtt=n.mqtt,console.log(n.mqtt),t.$toast.info("Ir code received")})).catch((function(e){i(),"AbortError"===e.name?t.$toast.info("Stopped listening after ".concat(n," seconds of no incoming messages")):t.$toast.error(String(e))}))},submitForm:function(){var t=[this.saveData.name,this.saveData.mqtt,this.saveData.id];t.some((function(t){return""===t.trim()}))?this.$toast.error("Name, id and mqtt required"):(this.save(),"editor"===this.mode?this.mode="edit":this.mode="normal")},glyph:function(t){return'<svg class="icon" style="fill: '.concat(this.saveData.color,'">\n                <use xlink:href="#').concat(t,'"></use>\n              </svg>')},closeModal:function(t){["add-overlay","close"].includes(t.target.id)&&(this.mode="normal")},findObjIndex:function(t){for(var e,n=t||this.saveData.id,a=0;a<this.list.length;a+=1)this.list[a].id===n&&(e=a);return e},generateUID:function(){return Math.random().toString(36).slice(-8)},cssVar:function(t){return getComputedStyle(document.documentElement).getPropertyValue(t)},getHostname:function(){return""}}}),f=d,v=n("2877"),m=Object(v["a"])(f,r,s,!1,null,null,null),h=m.exports;a["default"].config.productionTip=!1,a["default"].use(i.a,{duration:4e3,type:"default",position:"bottom"}),new a["default"]({render:function(t){return t(h)}}).$mount("#app")},a89b:function(t,e,n){}});
//# sourceMappingURL=app.bd051998.js.map