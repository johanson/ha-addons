(function(t){function e(e){for(var n,i,r=e[0],d=e[1],l=e[2],u=0,m=[];u<r.length;u++)i=r[u],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&m.push(s[i][0]),s[i]=0;for(n in d)Object.prototype.hasOwnProperty.call(d,n)&&(t[n]=d[n]);c&&c(e);while(m.length)m.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],n=!0,r=1;r<a.length;r++){var d=a[r];0!==s[d]&&(n=!1)}n&&(o.splice(e--,1),t=i(i.s=a[0]))}return t}var n={},s={app:0},o=[];function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=n,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],d=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var c=d;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),s=a("b079"),o=a.n(s),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.mode,attrs:{id:"app",tabindex:"0"},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"]))return null;t.mode="normal",t.loader=!1}}},[a("vue-context",{ref:"tabMenu",scopedSlots:t._u([{key:"default",fn:function(e){return[a("li",[a("a",{attrs:{href:"#","data-id":"add"},on:{click:function(a){return a.preventDefault(),t.tabContextMenu(a,e.data)}}},[t._v("Add")])]),a("li",[a("a",{attrs:{href:"#","data-id":"rename"},on:{click:function(a){return a.preventDefault(),t.tabContextMenu(a,e.data)}}},[t._v("Rename")])]),a("li",[a("a",{class:e.data,attrs:{href:"#","data-id":"remove"},on:{click:function(a){return a.preventDefault(),t.tabContextMenu(a,e.data)}}},[t._v("Remove")])])]}}])}),a("vue-context",{ref:"knobMenu",scopedSlots:t._u([{key:"default",fn:function(e){return[a("li",[a("a",{attrs:{href:"#","data-id":"add"},on:{click:function(a){return a.preventDefault(),t.knobContextMenu(a,e.data)}}},[t._v("Add")])]),a("li",[a("a",{attrs:{href:"#","data-id":"edit"},on:{click:function(a){return a.preventDefault(),t.knobContextMenu(a,e.data)}}},[t._v("Edit")])]),a("li",[a("a",{attrs:{href:"#","data-id":"sort"},on:{click:function(a){return a.preventDefault(),t.knobContextMenu(a,e.data)}}},[t._v("Sort")])]),a("li",[a("a",{attrs:{href:"#","data-id":"remove"},on:{click:function(a){return a.preventDefault(),t.knobContextMenu(a,e.data)}}},[t._v("Remove")])])]}}])}),a("div",{attrs:{id:"svg-sprite"}}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.loader,expression:"loader"}],attrs:{id:"loader"}},[a("div",{staticClass:"icon"})]),a("div",{attrs:{id:"add-overlay"},on:{click:t.closeModal,keydown:function(e){return(e.type.indexOf("key")||83===e.keyCode)&&e.ctrlKey&&e.shiftKey?t.submitForm(e):null}}},[a("form",{attrs:{action:"#",id:"form1",autocomplete:"off"}},[a("div",{attrs:{id:"close"},on:{click:t.closeModal}}),t._m(0),a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.name,expression:"saveData.name"}],ref:"name",attrs:{type:"text",id:"knob_name",required:""},domProps:{value:t.saveData.name},on:{input:function(e){e.target.composing||t.$set(t.saveData,"name",e.target.value)}}}),t._m(1),a("div",{attrs:{id:"mqtt"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.mqtt,expression:"saveData.mqtt"}],attrs:{type:"text",id:"knob_mqtt",required:""},domProps:{value:t.saveData.mqtt},on:{input:function(e){e.target.composing||t.$set(t.saveData,"mqtt",e.target.value)}}}),a("button",{attrs:{disabled:t.listeningMqtt},on:{click:function(e){return e.preventDefault(),t.receiveIR(e)}}},[t._v("Listen")])]),t._m(2),a("div",{attrs:{id:"knob_mqtt_topic"}},t._l(t.settings.topic_send,(function(e,n){return a("p",{key:n},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.topic_send,expression:"saveData.topic_send"}],attrs:{type:"radio",required:"",id:"mqttTopic-"+n},domProps:{checked:1===t.settings.topic_send.length,value:e,checked:t._q(t.saveData.topic_send,e)},on:{change:function(a){return t.$set(t.saveData,"topic_send",e)}}}),a("label",{attrs:{for:"mqttTopic-"+n}},[t._v(t._s(e))])])})),0),a("label",{attrs:{for:"knob_id"}},[t._v("Unique id "),a("span",{staticClass:"mono"},[t._v(" curl "+t._s(t.settings.hostname)+t._s(t.api.send)+"/"+t._s(t.saveData.id)+" ")])]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.id,expression:"saveData.id"}],attrs:{type:"text",id:"knob_id",required:"",readonly:""},domProps:{value:t.saveData.id},on:{input:function(e){e.target.composing||t.$set(t.saveData,"id",e.target.value)}}}),t._m(3),a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.icon,expression:"saveData.icon"}],attrs:{type:"text",id:"knob_icon"},domProps:{value:t.saveData.icon},on:{input:function(e){e.target.composing||t.$set(t.saveData,"icon",e.target.value)}}}),a("div",{attrs:{id:"glyphs"}},t._l(t.filteredGlyphs,(function(e){return a("div",{key:e,staticClass:"glyph",attrs:{"data-name":e,title:e},domProps:{innerHTML:t._s(t.glyph(e))},on:{click:function(a){t.saveData.icon=e}}})})),0),t._m(4),a("input",{directives:[{name:"model",rawName:"v-model",value:t.saveData.color,expression:"saveData.color"}],attrs:{type:"text",id:"knob_color"},domProps:{value:t.saveData.color},on:{input:function(e){e.target.composing||t.$set(t.saveData,"color",e.target.value)}}}),a("slider-picker",{model:{value:t.colors,callback:function(e){t.colors=e},expression:"colors"}}),a("button",{attrs:{form:"form1"},on:{click:function(e){return e.preventDefault(),t.submitForm(e)}}},[t._v("Save")]),t._m(5)],1)]),a("a",{ref:"undoButton",attrs:{href:"#",id:"undo"},on:{keydown:function(e){return(e.type.indexOf("key")||90===e.keyCode)&&e.ctrlKey?t.undo():null},click:function(e){return e.preventDefault(),t.undo()}}},[a("span",[t._v("Undo")]),a("svg",{staticClass:"icon"},[a("use",{attrs:{"xlink:href":"#fast-forward"}})])]),a("div",{attrs:{id:"tabs"}},t._l(t.data,(function(e,n){return a("div",{key:n,staticClass:"tab",class:{active:t.activeTab===n},attrs:{"data-id":n},on:{contextmenu:function(e){return e.preventDefault(),t.$refs.tabMenu.open(e,n)},click:function(e){t.activeTab=n}}},["tab-rename"===t.mode&&t.activeTab===n?a("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.name,expression:"item.name",modifiers:{trim:!0}}],attrs:{type:"text",id:"menu-item-"+n},domProps:{value:e.name},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveTab()},blur:[function(a){""===e.name?e.name="New":e.name=e.name,t.saveTab()},function(e){return t.$forceUpdate()}],input:function(a){a.target.composing||t.$set(e,"name",a.target.value.trim())}}}):a("span",[t._v(" "+t._s(e.name)+" ")])])})),0),a("draggable",{attrs:{id:"remote",disabled:"sort"!=this.mode,draggable:".item"},on:{change:t.save},model:{value:t.filteredData,callback:function(e){t.filteredData=e},expression:"filteredData"}},[a("div",{staticClass:"item-add",attrs:{slot:"footer",draggable:"false"},on:{click:function(e){t.mode="add"}},slot:"footer"},[a("div",{staticClass:"glyph"},[a("svg",{staticClass:"icon"},[a("use",{attrs:{"xlink:href":"#add"}})])])]),t._l(t.filteredData,(function(e){return a("div",{key:e.id,staticClass:"item",attrs:{title:e.name},on:{contextmenu:function(a){return a.preventDefault(),t.$refs.knobMenu.open(a,e.id)},click:function(a){return t.sendIR(e.id)}}},[e.icon?a("div",{staticClass:"glyph"},[a("svg",{staticClass:"icon",style:"fill:"+e.color},[a("use",{attrs:{"xlink:href":"#"+e.icon}})])]):a("div",{class:["no-icon len-"+e.name.length],style:"color:"+e.color},[t._v(" "+t._s(e.name)+" ")])])}))],2)],1)},r=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"knob_name"}},[t._v("Name "),a("span",[t._v("Name for your knob")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"knob_mqtt"}},[t._v("MQTT response "),a("span",[t._v("If no icon is selected, the name will be used")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"knob_mqtt_topic"}},[t._v("MQTT topic "),a("span",[t._v("Add new topics from HA configuration")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"knob_icon"}},[t._v("Icon "),a("span",[t._v("If no icon is selected, the name is being used")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{attrs:{for:"knob_color"}},[t._v("Color "),a("span",[t._v(" Color for the icon. Leave blank for default that depends on the parent theme. ")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",{staticClass:"keybinds"},[a("strong",[t._v("Control+Shift+S")]),t._v(" to save, "),a("strong",[t._v("Esc")]),t._v(" to close ")])}],d=(a("25f0"),a("ddb0"),a("5530")),l=a("310e"),c=a.n(l),u=a("c345"),m=a("899b"),f=(a("a89b"),{name:"App",components:{draggable:c.a,VueContext:m["a"],"slider-picker":u["Slider"]},data(){return{mode:"normal",loader:!0,glyphs:[],manager:{active:!1,text:"Manager"},activeTab:"default",data:{default:{name:"Default",knobs:[]}},dataHistory:{},colors:{hex:this.cssVar("--text")},saveData:{id:"",name:"",mqtt:"",topic_send:"",icon:"",color:this.cssVar("--text")},listeningMqtt:!1,settings:{topic_send:""},api:{prefix:this.getHostname()+"api/",receive:"ir/receive",send:"ir/send",save:"db/save",load:"db/load",settings:"settings"}}},computed:{filteredGlyphs(){return this.glyphs.filter(t=>t.toLowerCase().indexOf(this.saveData.icon.toLowerCase())>-1)},filteredData:{get(){return this.data[this.activeTab].knobs},set(t){this.data[this.activeTab].knobs=t}}},watch:{mode(t){"editor"===t?setTimeout(()=>this.$refs.name.focus(),500):"add"===t&&(this.saveData={name:"",mqtt:"",id:this.generateUID(),icon:"",color:this.cssVar("--text"),topic_send:this.saveData.topic_send},setTimeout(()=>this.$refs.name.focus(),500))},colors(t){this.saveData.color=t.hex}},filters:{defaultValue(t){return""===t?"New":t}},mounted(){this.load(),this.loadSVG()},methods:{load(){fetch(`${this.api.prefix}${this.api.load}`).then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status);return t.json()}).then(t=>{"error"===t.status?this.loadDefaultDB():this.data=t}).catch(t=>{this.$toast.error(String(t))}),fetch(`${this.api.prefix}${this.api.settings}`).then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status);return t.json()}).then(t=>{if(this.settings=t,[this.saveData.topic_send]=t.topic_send,t.dark_theme){const t=document.getElementsByTagName("html")[0];t.setAttribute("data-theme","dark")}}).catch(t=>{this.$toast.error(String(t))})},loadDefaultDB(){this.data={default:{name:"Default",knobs:[{id:"wn0gbd99",name:"Samsung Volume Up",mqtt:'{"Protocol":"SAMSUNG","Bits":32,"Data":"0xE0E0E01F"}',icon:"up-arrow",topic_send:""},{id:"wt9u3yzj",name:"Samsung Volume Down",mqtt:'{"Protocol":"SAMSUNG","Bits":32,"Data":"0xE0E0D02F"}',icon:"down-arrow",topic_send:""}]}}},toggleManager(){this.manager.active?(this.mode="normal",this.manager.text="Manager"):(this.manager.text="Normal",this.mode="normal"),this.manager.active=!this.manager.active},knobContextMenu(t,e){const a=t.target.dataset.id;"add"===a&&(this.mode="add"),"edit"===a&&(this.saveData=this.filteredData[this.findObjIndex(e)],this.mode="editor"),"sort"===a&&("sort"===this.mode?this.mode="normal":this.mode="sort"),"remove"===a&&(this.undo(!0),this.filteredData=this.filteredData.filter(t=>t.id!==e),this.save())},changeMqttTopic(t){this.saveData.topic_send=t},tabContextMenu(t,e){const a=t.target.dataset.id;if("rename"===a&&(this.activeTab=e,this.mode="tab-rename",setTimeout(()=>document.querySelector("#menu-item-"+e).focus(),200)),"add"===a){const t=this.generateUID();this.data=Object(d["a"])(Object(d["a"])({},this.data),{[t]:{name:"New",knobs:[]}}),this.activeTab=t,this.mode="tab-rename",setTimeout(()=>document.querySelector("#menu-item-"+t).focus(),200),this.save()}"remove"===a&&"default"!==e&&(e===this.activeTab&&(this.activeTab="default"),this.undo(!0),this.$delete(this.data,e),this.save())},saveTab(){this.mode="normal",this.save()},loadSVG(){const t=this;fetch("icons/sprite.svg").then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status);return t.text()}).then(e=>{const a=document.getElementById("svg-sprite");a.innerHTML=e;const n=(new DOMParser).parseFromString(e,"text/xml"),s=n.getElementsByTagName("symbol");if(!s.length)throw new Error("Cannot generate svg icons");this.loader=!1;for(let o=0;o<s.length;o+=1)t.glyphs.push(s[o].getAttribute("id"))}).catch(t=>{this.$toast.error(String(t))})},save(){"editor"===this.mode?this.filteredData[this.findObjIndex()]={id:this.saveData.id,name:this.saveData.name,mqtt:this.saveData.mqtt,topic_send:this.saveData.topic_send,icon:this.saveData.icon,color:this.saveData.color}:"add"===this.mode&&this.filteredData.push(this.saveData),fetch(`${this.api.prefix}${this.api.save}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(this.data)}).then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status)}).catch(t=>{this.$toast.error(String(t))})},sendIR(t){fetch(`${this.api.prefix}${this.api.send}/${t}`).then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status)}).then(()=>{this.loader=!1}).catch(t=>{this.$toast.error(String(t)),this.loader=!1})},receiveIR(){const t=this;this.loader=!0;const e=5,a=new AbortController,n=setTimeout(()=>{a.abort()},1e3*e);function s(){t.listeningMqtt=!1,t.loader=!1,clearTimeout(n)}fetch(`${this.api.prefix}${this.api.receive}`,{signal:a.signal}).then(t=>{if(!t.ok)throw new Error("API HTTP status "+t.status);return t.json()}).then(e=>{s(),t.saveData.mqtt=e.mqtt,this.$toast.info("Ir code received")}).catch(t=>{s(),"AbortError"===t.name?this.$toast.info(`Stopped listening after ${e} seconds of no incoming messages`):this.$toast.error(String(t))})},submitForm(){const t=this.saveData,e=[t.name,t.mqtt,t.id,t.topic_send];e.some(t=>""===t||void 0===t)?this.$toast.error("Name, id, mqtt and topic required"):(this.save(),"editor"===this.mode?this.mode="edit":this.mode="normal")},glyph(t){return`<svg class="icon" style="fill: ${this.saveData.color}">\n                <use xlink:href="#${t}"></use>\n              </svg>`},closeModal(t){["add-overlay","close"].includes(t.target.id)&&(this.mode="normal",this.loader=!1)},undo(t=!1){const e=this.$refs.undoButton;t?(this.dataHistory=JSON.parse(JSON.stringify(this.data)),e.classList="visible",e.focus(),setTimeout(()=>{e.classList=""},5e3)):(e.classList="",this.data=Object(d["a"])({},this.dataHistory),this.save())},findObjIndex(t){const e=t||this.saveData.id;let a;for(let n=0;n<this.filteredData.length;n+=1)this.filteredData[n].id===e&&(a=n);return a},generateUID(){return Math.random().toString(36).slice(-8)},cssVar(t){return getComputedStyle(document.documentElement).getPropertyValue(t)},getHostname(){return""}}}),v=f,h=a("2877"),p=Object(h["a"])(v,i,r,!1,null,null,null),g=p.exports;n["default"].config.productionTip=!1,n["default"].use(o.a,{duration:4e3,type:"default",position:"bottom"}),new n["default"]({render:t=>t(g)}).$mount("#app")},a89b:function(t,e,a){}});
//# sourceMappingURL=app.01804a48.js.map